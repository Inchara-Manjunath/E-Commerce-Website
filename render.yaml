services:
  - type: web
    name: ecommerce-backend
    env: node
    rootDir: ecommerce-backend
    buildCommand: npm ci
    startCommand: node server.js
    plan: free
    envVars:
      - key: PORT
        value: 3000
    autoDeploy: true

  - type: static
    name: ecommerce-frontend
    rootDir: ecommerce-frontend
    buildCommand: npm ci && npm run build
    staticPublishPath: dist
    plan: free
    envVars:
      # Set this after first deploy to the backend's public URL, e.g. https://ecommerce-backend.onrender.com
      - key: VITE_API_BASE
        value: ""
    redirects:
      - source: "/*"
        destination: "/index.html"
        status: 200

services:
  - type: web
    name: ecommerce-backend
    env: node
    rootDir: ecommerce-backend
    plan: free
    buildCommand: npm ci
    startCommand: node server.js
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      # Add DATABASE_URL here if you use an external DB
      # - key: DATABASE_URL
      #   value: postgres://user:pass@host:5432/db

  - type: static
    name: ecommerce-frontend
    rootDir: ecommerce-frontend
    buildCommand: npm ci && npm run build
    publishPath: dist
    envVars:
      - key: NODE_VERSION
        value: 20
      # This must point to the backend web service URL after it's created.
      # Example: https://ecommerce-backend-xxxxx.onrender.com
      - key: VITE_API_BASE
        value: https://YOUR-BACKEND-ONRENDER-URL


